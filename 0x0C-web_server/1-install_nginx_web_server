#!/usr/bin/env bash
# To install nginx server
# Update package lists
sudo apt update

# Install Nginx
sudo apt install -y nginx

# Create a simple webpage with "Hello World!" content
echo "Hello World!" > /var/www/html/index.html

# Set permissions on the webpage
chmod 644 /var/www/html/index.html

# Disable the default Nginx configuration
mv /etc/nginx/sites-enabled/default /etc/nginx/sites-available/default

# Create a new server block configuration
cat << EOF > /etc/nginx/sites-available/web-01.conf
server {
  listen 80;

  # Access log for debugging
  access_log /var/log/nginx/access.log;

  # Error log
  error_log /var/log/nginx/error.log;

  # Serve static content from /var/www/html
  location / {
    root /var/www/html;
    index index.html index.htm;
  }
}
EOF

# Activate the new server block configuration
ln -s /etc/nginx/sites-available/web-01.conf /etc/nginx/sites-enabled/web-01.conf

# Reload Nginx configuration (without systemctl)
killall -s HUP nginx

# Test Nginx with curl
curl -s localhost

# Check the response code (should be 200)
if [ $? -eq 0 ]; then
  echo "Success! Nginx is running and serving content."
else
  echo "Error! Nginx is not serving content as expected."
fi
